<%- include('partials/header', { title: 'L∆∞∆°ng' , additionalCSS: [''] }) %>
  <div class="app-container">
    <%- include('partials/sidebar', { currentPage: 'salaries' }) %>

      <!-- Main Content -->
      <main class="main-content">
        <header class="top-bar">
          <h1>Qu·∫£n l√Ω l∆∞∆°ng</h1>
          <div class="user-info">
            <span id="user-name">User</span>
            <button class="btn-logout">ƒêƒÉng xu·∫•t</button>
          </div>
        </header>

        <div class="content">
          <!-- Summary Cards -->
          <div class="row g-3 mb-4">
            <div class="col-lg-3 col-md-6 col-sm-6">
              <div class="summary-card">
                <div class="card-icon">üí∞</div>
                <div class="card-content">
                  <h3>T·ªïng thu nh·∫≠p</h3>
                  <p class="amount" id="total-income">0 VND</p>
                  <span class="period">T·∫•t c·∫£</span>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
              <div class="summary-card">
                <div class="card-icon">üè¢</div>
                <div class="card-content">
                  <h3>L∆∞∆°ng c√¥ng ty</h3>
                  <p class="amount" id="company-salary">0 VND</p>
                  <span class="period">Trung b√¨nh</span>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
              <div class="summary-card">
                <div class="card-icon">üíº</div>
                <div class="card-content">
                  <h3>Freelance</h3>
                  <p class="amount" id="freelance-income">0 VND</p>
                  <span class="period">Trung b√¨nh</span>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
              <div class="summary-card">
                <div class="card-icon">üìà</div>
                <div class="card-content">
                  <h3>TƒÉng tr∆∞·ªüng</h3>
                  <p class="amount" id="growth-rate">0%</p>
                  <span class="period">So v·ªõi th√°ng tr∆∞·ªõc</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Salaries List -->
          <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h2>L·ªãch s·ª≠ l∆∞∆°ng</h2>
              <button class="btn btn-primary" onclick="showAddModal()">
                <span class="icon">‚ûï</span> Th√™m m·ªõi
              </button>
            </div>

            <div id="salaries-list" class="table-container">
              <p class="loading">ƒêang t·∫£i d·ªØ li·ªáu...</p>
            </div>
          </div>
        </div>
      </main>
  </div>

  <!-- Add/Edit Salary Modal -->
  <div id="salaryModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeSalaryModal()">&times;</span>
      <h2 id="modalTitle">Th√™m L∆∞∆°ng</h2>
      <div style="margin-bottom: 15px;">
        <button type="button" class="btn btn-secondary" onclick="showMisaImportModal()">
          <span class="icon">üì•</span> Import t·ª´ MISA
        </button>
      </div>
      <form id="salaryForm">
        <input type="hidden" id="salaryId" />

        <div class="form-group">
          <label for="month">Th√°ng:</label>
          <input type="month" id="month" required />
        </div>

        <div class="form-group">
          <label for="company">C√¥ng ty:</label>
          <input type="text" id="company" value="VIHAT" />
        </div>

        <h3>L∆∞∆°ng c√¥ng ty</h3>
        <div class="form-group">
          <label for="baseSalary">L∆∞∆°ng c∆° b·∫£n (VND):</label>
          <input type="number" id="baseSalary" min="0" value="0" />
        </div>

        <div class="form-group">
          <label for="kpi">KPI (VND):</label>
          <input type="number" id="kpi" min="0" value="0" />
        </div>

        <div class="form-group">
          <label for="leader">Leader (VND):</label>
          <input type="number" id="leader" min="0" value="0" />
        </div>

        <div class="form-group">
          <label for="project">D·ª± √°n (VND):</label>
          <input type="number" id="project" min="0" value="0" />
        </div>

        <div class="form-group">
          <label for="overtime">TƒÉng ca (VND):</label>
          <input type="number" id="overtime" min="0" value="0" />
        </div>

        <div class="form-group">
          <label for="bonus13thMonth">Th∆∞·ªüng th√°ng 13 (VND):</label>
          <input type="number" id="bonus13thMonth" min="0" value="0" />
        </div>

        <h3>Freelance</h3>
        <div class="form-group">
          <label for="freelanceDakiatech">Dakiatech (VND):</label>
          <input type="number" id="freelanceDakiatech" min="0" value="0" />
        </div>

        <div class="form-group">
          <label for="freelanceOther">Kh√°c (VND):</label>
          <input type="number" id="freelanceOther" min="0" value="0" />
        </div>

        <div class="form-group">
          <label for="receiveDate">Ng√†y nh·∫≠n l∆∞∆°ng:</label>
          <input type="date" id="receiveDate" />
        </div>

        <div class="form-group">
          <label for="notes">Ghi ch√∫:</label>
          <textarea id="notes" rows="3"></textarea>
        </div>

        <div class="form-group" style="margin-top: 20px; padding: 15px; background: #f5f7fa; border-radius: 8px;">
          <h4>T·ªïng c·ªông:</h4>
          <p><strong>L∆∞∆°ng c√¥ng ty:</strong> <span id="displayTotalCompany">0 VND</span></p>
          <p><strong>Freelance:</strong> <span id="displayTotalFreelance">0 VND</span></p>
          <p style="font-size: 1.2em; color: #2ecc71;"><strong>T·ªïng thu nh·∫≠p:</strong> <span id="displayTotalIncome">0 VND</span></p>
        </div>

        <button type="submit" class="btn btn-primary">L∆∞u</button>
      </form>
    </div>
  </div>

  <style>
    .table-container {
      overflow-x: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th,
    .data-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }

    .data-table th {
      background: #f5f7fa;
      font-weight: 600;
      color: #2c3e50;
    }

    .data-table tbody tr:hover {
      background: #f8f9fa;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
      background-color: #fefefe;
      margin: 2% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 800px;
      border-radius: 8px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-content h3 {
      color: #2c3e50;
      margin-top: 20px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #3498db;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #2c3e50;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #3498db;
    }

    .btn-sm {
      padding: 5px 10px;
      font-size: 0.9em;
      margin: 0 2px;
      border: none;
      background: #3498db;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-sm:hover {
      background: #2980b9;
    }

    .btn-danger {
      background: #e74c3c;
    }

    .btn-danger:hover {
      background: #c0392b;
    }

    .btn-secondary {
      background: #95a5a6;
      color: white;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 14px;
    }

    .btn-secondary:hover {
      background: #7f8c8d;
    }

    .transaction-item {
      padding: 12px;
      border: 1px solid #ddd;
      margin-bottom: 8px;
      border-radius: 4px;
      cursor: pointer;
      background: #fff;
    }

    .transaction-item:hover {
      background: #f8f9fa;
      border-color: #3498db;
    }

    .transaction-item.selected {
      background: #e3f2fd;
      border-color: #3498db;
      border-width: 2px;
    }

    .transaction-list {
      max-height: 400px;
      overflow-y: auto;
      margin: 15px 0;
    }

    .misa-login-section,
    .misa-search-section {
      display: none;
    }

    .misa-login-section.active,
    .misa-search-section.active {
      display: block;
    }
  </style>

  <!-- MISA Import Modal -->
  <div id="misaImportModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeMisaImportModal()">&times;</span>
      <h2>Import thu nh·∫≠p t·ª´ MISA</h2>

      <!-- Login Section -->
      <div id="misaLoginSection" class="misa-login-section active">
        <p>ƒêƒÉng nh·∫≠p v√†o MISA Money Keeper ƒë·ªÉ t√¨m ki·∫øm giao d·ªãch thu nh·∫≠p:</p>
        <div class="form-group">
          <label for="misaUsername">Email/T√™n ƒëƒÉng nh·∫≠p:</label>
          <input type="text" id="misaUsername" placeholder="username@gmail.com" />
        </div>
        <div class="form-group">
          <label for="misaPassword">M·∫≠t kh·∫©u:</label>
          <input type="password" id="misaPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" />
        </div>
        <button type="button" class="btn btn-primary" onclick="loginToMisa()">ƒêƒÉng nh·∫≠p</button>
      </div>

      <!-- Search Section -->
      <div id="misaSearchSection" class="misa-search-section">
        <p>T√¨m ki·∫øm giao d·ªãch thu nh·∫≠p theo th√°ng:</p>
        <div class="form-group">
          <label for="misaSearchMonth">Ch·ªçn th√°ng:</label>
          <input type="month" id="misaSearchMonth" />
        </div>
        <button type="button" class="btn btn-primary" onclick="searchMisaTransactions()">T√¨m ki·∫øm</button>

        <!-- Transaction List -->
        <div id="misaTransactionList" class="transaction-list"></div>

        <div style="margin-top: 15px;">
          <button type="button" class="btn btn-primary" onclick="importSelectedMisaTransaction()">Import ƒë√£ ch·ªçn</button>
          <button type="button" class="btn btn-secondary" onclick="closeMisaImportModal()">H·ªßy</button>
        </div>
      </div>
    </div>
  </div>

  <%- include('partials/footer', { additionalJS: [ '/js/salaries.js' ] }) %>
