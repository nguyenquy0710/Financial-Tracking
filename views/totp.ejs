<%- include('partials/header', { title: 'TOTP Authenticator' , additionalCSS: ['/css/totp.css'] }) %>

  <div class="app-container">
    <%- include('partials/sidebar', { currentPage: 'totp' }) %>

      <!-- Main Content -->
      <main class="main-content">
        <header class="top-bar totp-header">
          <h1>üîê TOTP Authenticator</h1>
          <div class="header-actions">
            <button id="theme-toggle" class="btn btn-icon" title="Chuy·ªÉn ch·∫ø ƒë·ªô t·ªëi">
              <span class="icon">üåô</span>
            </button>
            <div class="user-info">
              <span id="user-name">User</span>
              <button class="btn-logout">ƒêƒÉng xu·∫•t</button>
            </div>
          </div>
        </header>

        <div class="content">
          <!-- Accounts List - Prioritized Section -->
          <section class="accounts-section card">
            <div class="section-header">
              <h2>Danh S√°ch T√†i Kho·∫£n</h2>
              <button type="button" class="btn btn-primary btn-add-account" id="show-add-form-btn">
                <span class="icon">‚ûï</span> Th√™m T√†i Kho·∫£n
              </button>
            </div>
            <div id="accounts-container">
              <div class="loading">ƒêang t·∫£i...</div>
            </div>
          </section>

          <!-- Add/Edit Account Form - Collapsible -->
          <section class="form-section card" id="form-section" style="display: none;">
            <div class="form-header">
              <h2 id="form-title">Th√™m T√†i Kho·∫£n M·ªõi</h2>
              <button type="button" class="btn btn-secondary btn-scan-qr" id="scan-qr-btn">
                <span class="icon">üì∑</span> Qu√©t QR Code
              </button>
            </div>
            <form id="account-form">
              <input type="hidden" id="account-id" value="">

              <div class="form-group">
                <label for="service-name">T√™n D·ªãch V·ª• *</label>
                <input type="text" id="service-name" class="form-control" placeholder="VD: Google, Facebook, GitHub..." required
                  data-bs-toggle="tooltip" data-bs-title="T√™n d·ªãch v·ª• ho·∫∑c ·ª©ng d·ª•ng m√† b·∫°n ƒëang th√™m t√†i kho·∫£n x√°c th·ª±c.">
                <small>T√™n d·ªãch v·ª• ho·∫∑c ·ª©ng d·ª•ng m√† b·∫°n ƒëang th√™m t√†i kho·∫£n x√°c th·ª±c.</small>
              </div>

              <div class="form-group">
                <label for="username">T√™n Ng∆∞·ªùi D√πng *</label>
                <input type="text" id="username" class="form-control" placeholder="VD: user@example.com" required>
                <small>T√™n ng∆∞·ªùi d√πng ho·∫∑c email li√™n k·∫øt v·ªõi t√†i kho·∫£n d·ªãch v·ª•.</small>
              </div>

              <div class="form-group">
                <label for="secret-key">Secret Key (Kh√≥a B√≠ M·∫≠t) *</label>
                <input type="text" id="secret-key" class="form-control" placeholder="VD: JBSWY3DPEHPK3PXP" required pattern="[A-Z2-7]+"
                  title="Secret key ph·∫£i l√† k√Ω t·ª± A-Z v√† 2-7">
                <small>Secret key th∆∞·ªùng c√≥ ƒë·ªãnh d·∫°ng Base32 (ch·ªâ ch·ª©a A-Z v√† 2-7)</small>
              </div>

              <div class="form-group">
                <label for="otp-type">Lo·∫°i kh√≥a *</label>
                <select id="otp-type" class="form-control form-select">
                  <option value="totp" selected>TOTP (Th·ªùi gian)</option>
                  <option value="hotp">HOTP (S·ªë l·∫ßn s·ª≠ d·ª•ng)</option>
                </select>
                <small>Lo·∫°i kh√≥a x√°c th·ª±c (TOTP ho·∫∑c HOTP)</small>
              </div>

              <div class="form-group">
                <label for="digits">S·ªë ch·ªØ s·ªë c·ªßa m√£ OTP *</label>
                <select id="digits" class="form-control form-select">
                  <option value="6" selected>6 ch·ªØ s·ªë</option>
                  <option value="7">7 ch·ªØ s·ªë</option>
                  <option value="8">8 ch·ªØ s·ªë</option>
                </select>
                <small>S·ªë ch·ªØ s·ªë trong m√£ OTP (m·∫∑c ƒë·ªãnh l√† 6)</small>
              </div>

              <div class="form-group">
                <label for="interval">Kho·∫£ng th·ªùi gian (gi√¢y)</label>
                <input type="number" id="interval" class="form-control" value="30" min="10" max="300" required>
                <small>Ch·ªâ √°p d·ª•ng cho TOTP. M·∫∑c ƒë·ªãnh l√† 30 gi√¢y.</small>
              </div>

              <div class="form-group">
                <label for="counter">B·ªô ƒë·∫øm (Ch·ªâ HOTP)</label>
                <input type="number" id="counter" class="form-control" value="0" min="0" required>
                <small>Ch·ªâ √°p d·ª•ng cho HOTP. B·∫Øt ƒë·∫ßu t·ª´ 0.</small>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn btn-primary" id="submit-btn">
                  <span class="icon">‚ûï</span> Th√™m T√†i Kho·∫£n
                </button>
                <button type="button" class="btn btn-secondary" id="cancel-btn" style="display: none;">
                  <span class="icon">‚ùå</span> H·ªßy
                </button>
              </div>
            </form>
          </section>
        </div>
      </main>
  </div>

  <!-- Notification Toast -->
  <div id="notification" class="notification"></div>

  <!-- QR Scanner Modal -->
  <div id="qr-scanner-modal" class="qr-modal" style="display: none;">
    <div class="qr-modal-content">
      <div class="qr-modal-header">
        <h3>Qu√©t QR Code TOTP</h3>
        <button type="button" class="qr-close-btn" id="close-qr-scanner">&times;</button>
      </div>
      <div class="qr-modal-body">
        <div id="qr-reader" style="width: 100%;"></div>
        <div id="qr-reader-results" class="qr-results"></div>
      </div>
    </div>
  </div>

  <!-- otplib library for TOTP generation -->

  <%- include('partials/footer', { additionalJS: [ '/js/vendor/buffer.js' , '/js/vendor/otplib.js' , '/js/vendor/html5-qrcode.min.js' ,'/js/totp-indexeddb.js'
    , '/js/totp-lib.js' , '/js/totp.js' ] }) %>
