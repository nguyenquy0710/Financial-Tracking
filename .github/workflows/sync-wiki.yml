name: Sync Wiki Documentation
run-name: Sync Wiki - ${{ github.event_name }} on ${{ github.ref_name }}

on:
  push:
    branches:
      - main
      - master
      - develop
    paths:
      - 'wiki/**'
  workflow_dispatch: # Allow manual trigger
  repository_dispatch: # âœ… Cho phÃ©p kÃ­ch hoáº¡t tá»« bÃªn ngoÃ i (vÃ­ dá»¥: tá»« má»™t workflow khÃ¡c)
  release:
    # created : # âœ… Chá»‰ cháº¡y khi release Ä‘Æ°á»£c táº¡o
    # published: # âœ… Chá»‰ cháº¡y khi release Ä‘Æ°á»£c phÃ¡t hÃ nh
    types: [published] # âœ… Chá»‰ cháº¡y khi release Ä‘Æ°á»£c táº¡o

permissions:
  contents: write

jobs:
  sync-wiki:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout main repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: Clone wiki repository
        run: |
          git clone https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.wiki.git wiki-repo
      
      - name: Copy wiki files
        run: |
          # Copy all markdown files from wiki/ to wiki-repo/
          cp wiki/*.md wiki-repo/
          
          # List files that will be synced
          echo "Files to be synced:"
          ls -la wiki-repo/*.md
      
      - name: Commit and push changes
        run: |
          cd wiki-repo
          
          # Check if there are changes
          if [[ -n $(git status --porcelain) ]]; then
            git add .
            
            # Get the commit message from the triggering commit
            COMMIT_MSG="${{ github.event.head_commit.message }}"
            
            # Create a meaningful commit message
            git commit -m "Auto-sync wiki from main repo
            
            Source commit: ${{ github.sha }}
            Message: ${COMMIT_MSG}
            
            Synced by GitHub Actions"
            
            # Push changes
            git push origin master
            
            echo "âœ… Wiki synced successfully!"
          else
            echo "â„¹ï¸ No changes to sync"
          fi
      
      - name: Summary
        run: |
          echo "### Wiki Sync Summary ðŸ“š" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Repository:** ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
          echo "**Branch:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "**Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "**Wiki URL:** https://github.com/${{ github.repository }}/wiki" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Wiki documentation has been synced successfully! ðŸŽ‰" >> $GITHUB_STEP_SUMMARY
